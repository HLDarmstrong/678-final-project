---
title: "678-final-project"
author: "Shengbo Wang"
date: "2022-11-29"
output:
  pdf_document: default
  word_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = F,
	message = FALSE,
	warning = FALSE
)
```

```{r}
library(tidyr)
library(ggplot2)
library(tidyverse)
library(dplyr)
library(knitr)
library(stringr)
library(kableExtra)
library(lme4)
```
#Abstract

The American football is one of the most popular sports in United State, 
I built a multilevel model with group level team and position.
This report cotain Introduction, Method, Result and Discussion.
#Introduction
The National Football League is a professional American football league that consists of 32 teams.

#Methods

##Data
The data come from the Kaggle.com, I used two source of data. One is from (https://www.kaggle.com/datasets/trolukovich/football-players-salaries) which contain the Football players aslaries. It contains all time NFL players' salaries.
And the other from (https://www.kaggle.com/datasets/toddsteussie/nfl-play-statistics-dataset-2004-to-present) which 20 data sets in many factors of NFL players. This data source  provides play-by-play data from the 2004 to 2019.

First thing is to clean the data and combine the data into one data frame, expect the prime key I chose 10 variables as table shows below.

| column names    | explanation                                         |
| :--:            | :-----                                              |
| PlayerId        | Structured id name of player                        |
| nflId           | Structured NFL id name of player                    |
| position        | Position of player                                  |
| team            | Team of player                                      |
| salary          | Annual salary of player (dollars)                   |
| round           | Round associated with pick                          |
| pick            | Ordinal value of draft selection                    |
| draftTradeValue | NFL draft chart used to value draft day trades      |
| rushYards       | Yards gained from scrimmage                         |
| recYards        | Total yards gained from scrimmage                   |
| recYac          | Yards after catch                                   |
| fumTurnover     | Fumble resulting in a turnover (1 = True, 0 = False)|


```{r}
players <- read_csv("players.csv") %>% 
  dplyr::select(playerId,nameFull,nflId,heightInches,weight)
salaries <- read_csv("football_salaries.csv") %>%
  dplyr::select(position,nameFull=player,team,salary=avg_year)
data1 <- inner_join(players,salaries) 

draft <- read_csv("draft.csv")%>%
  group_by(playerId) %>%
  dplyr::select(playerId,round,pick,draftTradeValue)
data2 <- inner_join(data1,draft,by="playerId") 
```

```{r}
rusher <- read_csv("rusher.csv") %>%
  dplyr::select(playerId,rushYards) %>% 
  group_by(playerId) %>%
  summarise(rushYards=sum(rushYards)) 
data3 <- inner_join(data2,rusher)

receiver <- read_csv("receiver.csv") %>% 
  dplyr::select(playerId,recYards,recYac) %>% 
  group_by(playerId) %>% 
  summarise(recYards=sum(recYards),
            recYac=sum(recYac))
data4 <- inner_join(data3 ,receiver)

fumbles <- read_csv("fumbles.csv") %>% 
  dplyr::select(playerId,fumTurnover) %>% 
  group_by(playerId) %>% 
  summarise(fumTurnover=sum(fumTurnover))
data5 <- inner_join(data4,fumbles)


data <- data.frame(data5) %>% na.omit()
```

```{r}
ggplot(data =data) + 
  aes(x = log(recYards + 1), y = log(salary)) + 
  geom_point(aes(color = factor(team)), size = .6) + 
  geom_smooth(aes(color = factor(team)), method = "lm", se = FALSE, formula = 'y ~ x')
```

```{r}
ggplot(data = data) + 
  aes(x = log(recYards + 1), y = log(salary)) + 
  geom_point(aes(color = factor(position)), size = .6) + 
  geom_smooth(aes(color = factor(position)), method = "lm", se = FALSE, formula = 'y ~ x')
```
```{r}
ggplot(data =data) + 
  aes(x = log(rushYards + 1), y = log(salary)) + 
  geom_point(aes(color = factor(team)), size = .6) + 
  geom_smooth(aes(color = factor(team)), method = "lm", se = FALSE, formula = 'y ~ x')
```

```{r}
ggplot(data = data) + 
  aes(x = log(rushYards + 1), y = log(salary)) + 
  geom_point(aes(color = factor(position)), size = .6) + 
  geom_smooth(aes(color = factor(position)), method = "lm", se = FALSE, formula = 'y ~ x')
```

```{r}
ggplot(data =data) + 
  aes(x = log(fumTurnover + 1), y = log(salary)) + 
  geom_point(aes(color = factor(team)), size = .6) + 
  geom_smooth(aes(color = factor(team)), method = "lm", se = FALSE, formula = 'y ~ x')
```

```{r}
ggplot(data = data) + 
  aes(x = log(fumTurnover + 1), y = log(salary)) + 
  geom_point(aes(color = factor(position)), size = .6) + 
  geom_smooth(aes(color = factor(position)), method = "lm", se = FALSE, formula = 'y ~ x')
```

```{r}
model <- lmer(salary~rushYards+recYards+recYac+fumTurnover+draftTradeValue+
                (1+rushYards+recYards+recYac+fumTurnover+draftTradeValue|team)+
                (1+heightInches+weight|position),
              data=data)
summary(model)
```


